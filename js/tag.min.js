(function(A,c){function j(a){this.text="";this.link="#";this.btn="&#10005;";this.btnClass="";this.load(a)}function m(a){this.searchTerm=a;this.params={}}function y(a){return this.each(function(){var b=c(this),d=b.data("taginput");d||(b.data("taginput",{config:c.extend(!0,r,a),tags:[]}),d=b.data("taginput"));b.css({width:d.config.wrapperWidth,height:d.config.rowHeight});b.find("div").eq(0).css("width",d.config.contentWidth);b.find("input").attr("placeholder",d.config.placeHolder);var e=this,f=c(this),
g=f.data("taginput");f.on(h.CLICK,"a:not(."+g.config.pendingClass+") i",function(a){n.call(e,c(this).closest("a").data("text"));a.preventDefault()});f.on(h.CLICK,"a."+g.config.pendingClass+" i",function(a){var b=c(this).closest("a"),e=new j(b.data("text")),d=f.find("button");e.text&&!p(g.tags,e.text)&&(g.tags.push(e),b.removeClass(g.config.pendingClass).find("i").html(e.btn),d.addClass("add"),f.off(h.CLICK,"a:not(."+g.config.pendingClass+") i"));a.preventDefault()});f.on(h.KEYDOWN,"input",function(a){var b=
a.keyCode||a.which,d=c(this).val();if((b===l.DELETE||b===l.BACKSPACE)&&!d)n.call(e,c(this).parent("li").prev().find("a").data("text")),a.preventDefault();b===l.ENTER&&!g.config.autoSearch&&d&&(s.call(e,d),k.call(e),c(this).val(""))});if(g.config.autoSearch)f.on(h.KEYUP,"input",function(a){var b=c(this).val(),d=new m(b);t(function(){u.call(e,d);k.call(e)},800);a.preventDefault()});f.on(h.CLICK,"button",function(a){var b=c(this),d=f.find("input").val();b.hasClass("add")?(b.removeClass("add"),q.call(e,
!0),f.on(h.CLICK,"a:not(."+g.config.pendingClass+") i",function(a){n.call(e,c(this).closest("a").data("text"));a.preventDefault()})):u.call(e,new m(d));k.call(e);a.preventDefault()})})}function u(a){var b=this,d=c(this),e=d.data("taginput"),f="",g={},h=[];q.call(b,!0);d.find("input").val("");a.getTerm()&&(e.config.localStore&&(f=sessionStorage.getItem(a.getTerm()))?(d=new c.Deferred,h=JSON.parse(f),d.resolve(),g=d.promise()):(f=a.getParams(),g=c.ajax({type:e.config.callMethod,url:e.config.callURL,
dataType:"json",data:f}).success(function(b){h=b;if(e.config.localStore){var d=a.getTerm();b=JSON.stringify(b);var f=null,g=c.type(b);if("array"===g||"object"===g)f=JSON.stringify(b);"string"===g&&(f=b);f&&sessionStorage.setItem(d,f)}})),g.done(function(){h&&(c.each(h,function(){s.call(b,this,e.config.pendingClass)}),k.call(b));e.config.afterSearchCompleted.call(b)}))}function s(a,b){var d=c(this),e=d.data("taginput"),f=new j(a);f.text&&!p(e.tags,f.text)&&(b!==e.config.pendingClass?e.tags.push(f):
(f.btnClass=e.config.pendingClass,f.btn="&#10003"),c("<li></li>",{html:f.buildHTML()}).insertBefore(d.find("input").parent("li")));e.config.afterTagAdded.call(this)}function n(a){var b=c(this).data("taginput");a&&(b.tags=c.grep(b.tags,function(b){return b.text!==a}),v.call(this));b.config.afterTagDeleted.call(this)}function p(a,b){var d=!1;c.each(a,function(){this.text===b&&(d=!0)});return d}function k(){var a=c(this),b=a.data("taginput"),d=a.find("input"),e=a.find("li").eq(-2),f=1;e.length&&(e=e.position().left-
a.position().left+e.outerWidth(!0)+1,d.css("width",b.config.contentWidth-e>b.config.minInputWidth?b.config.contentWidth-e:"100%"));f+=parseInt((d.position().top-a.position().top)/b.config.rowHeight,10);a.animate({height:f*b.config.rowHeight},80)}function v(){var a=c(this),b=a.data("taginput"),d=[];q.call(this);b.tags.length&&(c.each(b.tags,function(){d.push("<li>"+this.buildHTML()+"</li>")}),a.find("ul").prepend(z(d)));k.call(this)}function q(a){var b=c(this),d=b.data("taginput");b.find("li").filter(function(){return a?
c(this).find("a."+d.config.pendingClass).length:c(this).find("a:not(."+d.config.pendingClass+")").length}).remove()}function z(a){var b="";"string"===c.type(a)&&(b=a);"array"===c.type(a)&&(b=a.join(""));return b||""}j.Text={MAX:10,MIN:2};j.prototype={load:function(a){var b=this;c.isPlainObject(a)&&!c.isEmptyObject(a)&&c.each(a,function(a,c){b.hasOwnProperty(a)&&""!==c&&("link"===a?b.setLink(c):b[a]=c)});if("string"===c.type(a)||"number"===c.type(a))b.text=c.trim(a)},buildHTML:function(){var a;return this.text?
(a="<a "+('href="'+this.link+'" '),this.btnClass&&(a+='class="'+this.btnClass+'" '),a+='data-text="'+this.text+'" ',a+=">",a+=this.getText()+'<span class="input-tag-close"><i>'+this.btn+"</i></span>",a+="</a>"):null},setLink:function(a,b){var d=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,e=a||null,f=b||!1;if("string"!==c.type(e))throw Error("Please include a vailid url.");if(f&&!d.test(e))throw Error("Please include an absolute url.");this.link=e;return this},
getText:function(){var a=c.trim(this.text);return a.length>j.Text.MAX?a.slice(0,j.Text.MAX-3)+"...":a}};m.prototype={addParam:function(a,b){this.params[a]=b},removeParam:function(a){delete this.params[a]},getParams:function(){return this.params},getTerm:function(){return this.searchTerm}};var r,l,h;l={DELETE:8,BACKSPACE:46,ENTER:13,UP:38,DOWN:40};h={CLICK:"click",DBCLICK:"dblclick",KEYDOWN:"keydown",KEYUP:"keyup",SUBMIT:"submit"};r={wrapperWidth:300,contentWidth:270,minInputWidth:30,rowHeight:30,
placeHolder:"",pendingClass:"pending",callURL:"",callMethod:"post",localStore:!0,autoSearch:!1,afterTagAdded:c.noop,afterTagDeleted:c.noop,afterSearchCompleted:c.noop};var w={importData:function(a){return this.each(function(){var b=c(this).data("taginput")||{},d=c.type(a);if(("array"===d||"object"===d)&&b){var e=c(this).data("taginput");c.each(a,function(){var a=new j(this);p(e.tags,a.text)||e.tags.push(a)});v.call(this)}else c.error("Error occurs")})},destory:function(){return this.each(function(){c(this).removeData("taginput")})}},
t,x=0;t=function(a,b){clearTimeout(x);x=setTimeout(a,b)};c.fn.tagInput=function(a){if(w[a])return w[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return y.apply(this,arguments);c.error("Method '"+a+"' does not exist on jQuery.tagInput")}})(window,jQuery);